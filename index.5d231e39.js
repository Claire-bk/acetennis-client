const baseURL="https://acetennis.herokuapp.com";window.onload=()=>{"true"===localStorage.getItem("DarkTheme")?(document.getElementById("darkmode").checked=!0,document.documentElement.classList.toggle("dark-mode")):document.getElementById("darkmode").checked=!1,localStorage.getItem("PlayerId")?displayJoinMatch("cancel"):displayJoinMatch("join"),"true"===sessionStorage.getItem("isLogin")&&sessionStorage.getItem("username")?(document.querySelector(".icon__join").classList.add("invisible"),document.querySelector(".icon__logout").classList.remove("invisible")):document.querySelector(".icon__logout").classList.add("invisible")};const navBarIcon=document.querySelector(".navBar__icon"),navBarMenu=document.querySelector(".navBar__menu"),icon=document.querySelector(".icon"),navBarLogo=document.querySelector(".navBar__logo");navBarLogo.addEventListener("click",(()=>{navBarLogo.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})),navBarIcon.addEventListener("click",(()=>{navBarMenu.classList.toggle("open")})),navBarMenu.addEventListener("click",(e=>{const t=e.target.dataset.link;if(null==t)return;document.querySelector(t).scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),navBarMenu.classList.toggle("open")}));const signUp=document.querySelector(".icon__join");signUp.addEventListener("click",(e=>{window.location="../public/component/signup.html"}));const themeToggle=document.querySelector("#darkmode");themeToggle.addEventListener("change",(e=>{let t=e.target.checked;console.log("darkmode ${checked"),t?(localStorage.setItem("DarkTheme","true"),document.documentElement.classList.toggle("dark-mode")):(localStorage.setItem("DarkTheme","false"),document.documentElement.classList.toggle("dark-mode"))}));const logout=document.querySelector(".icon__logout");logout.addEventListener("click",(()=>{sessionStorage.clear(),localStorage.clear(),window.location="index.html"}));const date=new Date,monthNum=date.getMonth(),fullYear=date.getFullYear(),today=date.getDate(),monthString=["January","Febrary","March","April","May","June","July","August","September","October","November","December"],lastDayOfMonth=[31,28,31,30,31,30,31,31,30,31,30,31];let currMonth=monthNum,currYear=fullYear;const month=document.querySelector(".month");month.innerHTML=monthString[monthNum],(fullYear%4==0&&fullYear%100!=0||fullYear%400==0)&&(lastDayOfMonth[1]=29);const days=document.querySelector(".days");for(let e=1;e<=lastDayOfMonth[monthNum];e++)days.innerHTML+=e===today?`<li class="day" data-day="${e}"><span class="active">${e}</span></li>`:`<li class="day" data-day="${e}">${e}</li>`;function fetchMatch(e,t){const n=`${fullYear}-${currMonth+1}-${e}`,o=`${baseURL}/event?date=${n}`;t-e>0?fetchMatchResult(`${baseURL}/matches?date=${n}`):fetchEventInfo(o)}function fetchMatchResult(e){fetch(e,{method:"GET",headers:{"content-type":"application/json"}}).then((e=>e.json())).then((e=>{displayMatchResult(e)})).catch((e=>{console.log(e)}))}days.addEventListener("click",(e=>{const t=e.target.dataset.match;t&&fetchMatch(parseInt(t),today)}));const matchInfo=document.querySelector("#match-info");function displayMatchResult(e){matchInfo.removeAttribute("invisible");for(let t=0;t<e.length;t++)matchInfo.innerHTML+=`<div class="match-info__result">\n            <h3>Court : ${e[t].courtNum}</h3>\n            <p>${e[t].playerA1}  :  ${e[t].playerB1}</p>\n            <p>${e[t].playerA2}  :  ${e[t].playerB2}</p>\n            <p>${e[t].scoreA} : ${e[t].scoreB}</p>\n            </div>`}function fetchEventInfo(e){fetch(e,{method:"GET",headers:{"content-type":"application/json"}}).then((e=>e.json())).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))}function displayEvents(){fetch(`${baseURL}/event?month=${currMonth+1}&year=${currYear}&date=`,{method:"GET",headers:{"content-Type":"application/json"}}).then((e=>e.json())).then((e=>{displayMatchDays(e),updateJoinMatchText(e)})).catch((e=>{console.log(e),console.log("Get events request failed")}))}function getJoinMatchInfo(){if(!sessionStorage.getItem("isLogin"))return;const e=sessionStorage.getItem("username");if(!e)return;const t=localStorage.getItem("UpcomingMatch");t&&fetch(`${baseURL}/players?username=${e}&date=${t}`,{method:"GET",headers:{"content-Type":"application/json"}}).then((e=>400===e.status?(localStorage.removeItem("PlayerId"),void displayJoinMatch("join")):e.json())).then((e=>{"undefined"!=e.id&&(localStorage.setItem("PlayerId",`${e.id}`),displayJoinMatch("cancel"))})).catch((e=>{localStorage.removeItem("PlayerId"),displayJoinMatch("join")}))}displayEvents();const joinMatch=document.querySelector("#join-match"),matchText=document.querySelector(".join-match__text"),joinMatchBtn=document.querySelector(".join-match__btn"),cancelMatchBtn=document.querySelector(".cancel-match__btn");function displayJoinMatch(e){"join"===e?(joinMatchBtn.classList.remove("invisible"),cancelMatchBtn.classList.add("invisible")):"cancel"===e&&(joinMatchBtn.classList.add("invisible"),cancelMatchBtn.classList.remove("invisible"))}function getFormatDate(e){let t=(e.getMonth()+1).toString(),n=e.getDate().toString(),o=e.getFullYear();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[o,t,n].join("-")}function updateJoinMatchText(e){const t=findUpcomingDate(e);if(null==t)joinMatch.setAttribute("class","invisible"),joinMatchBtn.setAttribute("class","invisible"),localStorage.removeItem("UpcomingMatch");else{const e=getFormatDate(t);matchText.innerHTML=`Upcoming match game <br /> ${t.getDate()}  ${monthString[t.getMonth()]} ${t.getFullYear()}  `,matchText.setAttribute("data-date",`${e}`),joinMatch.removeAttribute("invisible"),localStorage.setItem("UpcomingMatch",`${e}`)}}function findUpcomingDate(e){const t=new Date;for(let n=0;n<e.length;n++){const o=new Date(e[n].date),a=o-t;if(a>1){const e=Math.floor(a/1e3/60/60);if(e>1&&e<168)return o}}}function displayMatchDays(e){for(let t=0;t<e.length;t++){const n=new Date(e[t].date).getDate();for(let e=1;e<=lastDayOfMonth[monthNum];e++){const t=document.querySelector(`.day[data-day="${e}"]`);t.dataset.day===n.toString()&&(t.innerHTML=`<span class="matches" data-match=${t.dataset.day}>${e}</span>`)}}}function getHeaders(){return{Authorization:`Bearer ${localStorage.getItem("TOKEN")}`}}joinMatchBtn.addEventListener("click",(()=>{const e=sessionStorage.getItem("username");if(!sessionStorage.getItem("isLogin")&&!e)return void(window.location.href="../public/component/login.html");const t=matchText.getAttribute("data-date");t&&fetch(`${baseURL}/players`,{method:"POST",headers:{"content-Type":"application/json"},body:JSON.stringify({username:`${e}`,date:`${t}`})}).then((e=>e.json())).then((e=>{console.log("join match response "),console.log(e),e.id||(localStorage.setItem("PlayerId",`${e}`),displayJoinMatch("cancel"))})).catch((e=>{console.log(e),console.log("Fail to join match play")}))})),cancelMatchBtn.addEventListener("click",(()=>{const e=localStorage.getItem("PlayerId");fetch(`${baseURL}/players/${e}`,{method:"DELETE",headers:{"content-Type":"application/json"}}).then((e=>{displayJoinMatch("join"),localStorage.removeItem("PlayerId")})).catch((e=>{console.log(e),console.log("Fail to cancel match play")}))})),getJoinMatchInfo();
//# sourceMappingURL=index.5d231e39.js.map
